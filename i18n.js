function initLanguage() {
    console.log('Initializing language...');
    const languageSelector = document.getElementById('languageSelector');
    
    i18next.init({
        lng: localStorage.getItem('language') || 'vi',
        resources: {
            en: {
                translation: {
                    title: 'ToolHub - Multi-Tool Hub',
                    home: 'Home',
                    history: 'History',
                    contact: 'Contact',
                    summarize: 'Text Summary',
                    'length-converter': 'Length Converter',
                    calculator: 'Calculator',
                    'password-generator': 'Password Generator',
                    'char-counter': 'Character Counter',
                    'url-checker': 'URL Checker',
                    'temp-converter': 'Temperature Converter',
                    'currency-converter': 'Currency Converter',
                    'qr-generator': 'QR Code Generator',
                    'image-compressor': 'Image Compressor',
                    'bmi-calculator': 'BMI Calculator',
                    'area-converter': 'Area Converter',
                    welcome: 'Welcome to ToolHub',
                    description: 'Summarize text, convert units, generate QR codes, and more - all free and easy to use.',
                    summarizeDesc: 'Condense long content into a concise summary using AI.',
                    lengthConverterDesc: 'Convert length between meters, kilometers, centimeters, inches, feet, and yards.',
                    calculatorDesc: 'Perform basic calculations: addition, subtraction, multiplication, division.',
                    passwordGeneratorDesc: 'Generate secure random passwords with customizable length and character types.',
                    charCounterDesc: 'Count characters and words in your text.',
                    urlCheckerDesc: 'Check if a URL is valid and safe.',
                    tempConverterDesc: 'Convert between Celsius, Fahrenheit, and Kelvin.',
                    currencyConverterDesc: 'Convert between different currencies using real-time rates.',
                    qrGeneratorDesc: 'Generate QR codes for URLs or text.',
                    imageCompressorDesc: 'Compress images to reduce file size.',
                    bmiCalculatorDesc: 'Calculate your Body Mass Index (BMI).',
                    areaConverterDesc: 'Convert between square meters, kilometers, hectares, square feet, and mau.',
                    short: 'Short (~20%)',
                    medium: 'Medium (~30%)',
                    long: 'Long (~40%)',
                    meter: 'Meter (m)',
                    kilometer: 'Kilometer (km)',
                    centimeter: 'Centimeter (cm)',
                    inch: 'Inch (in)',
                    foot: 'Foot (ft)',
                    yard: 'Yard (yd)',
                    add: 'Add (+)',
                    subtract: 'Subtract (-)',
                    multiply: 'Multiply (*)',
                    divide: 'Divide (/)',
                    uppercase: 'Uppercase (A-Z)',
                    lowercase: 'Lowercase (a-z)',
                    numbers: 'Numbers (0-9)',
                    symbols: 'Symbols (!@#$%)',
                    celsius: 'Celsius (°C)',
                    fahrenheit: 'Fahrenheit (°F)',
                    kelvin: 'Kelvin (K)',
                    m2: 'Square Meter (m²)',
                    km2: 'Square Kilometer (km²)',
                    ha: 'Hectare (ha)',
                    ft2: 'Square Foot (ft²)',
                    mau: 'Mau (mẫu)',
                    creator: 'Creator',
                    dob: 'Date of Birth',
                    email: 'Email',
                    phone: 'Phone',
                    close: 'Close',
                    usageStats: 'Usage Statistics',
                    times: 'times',
                    error: {
                        emptyText: 'Please enter valid text!',
                        invalidNumber: 'Please enter a valid positive number!',
                        invalidUrl: 'Please enter a valid URL!',
                        textTooLong: 'Text is too long (max 10,000 characters)!',
                        invalidLength: 'Length must be between 8 and 32!',
                        selectCharacterType: 'Please select at least one character type!',
                        divideByZero: 'Cannot divide by zero!',
                        noImage: 'Please select an image!',
                        invalidImage: 'Invalid image format!',
                        apiFailed: 'Failed to fetch exchange rate.',
                        apiError: 'Error connecting to API.',
                        unsafeUrl: 'Unsafe URL detected!',
                        qrFailed: 'Failed to generate QR code!',
                        compressFailed: 'Failed to compress image!',
                        summarizeFailed: 'Failed to summarize text!'
                    },
                    summarizeText: 'Summarize',
                    convertLength: 'Convert',
                    calculate: 'Calculate',
                    generatePassword: 'Generate',
                    copyPassword: 'Copy',
                    countChars: 'Count',
                    checkURL: 'Check',
                    convertTemp: 'Convert',
                    convertCurrency: 'Convert',
                    generateQR: 'Generate QR',
                    compressImage: 'Compress',
                    calculateBMI: 'Calculate BMI',
                    convertArea: 'Convert',
                    searchTools: 'Search',
                    noHistory: 'No history available.',
                    historyCleared: 'History cleared!',
                    noToolsFound: 'No tools found!',
                    originalValue: 'Original Value',
                    originalUnit: 'Original Unit',
                    convertedValue: 'Converted Value',
                    targetUnit: 'Target Unit',
                    result: 'Result',
                    characters: 'Characters',
                    words: 'Words',
                    validUrl: 'Valid URL',
                    compressedImage: 'Compressed image',
                    download: 'Download',
                    bmi: {
                        underweight: 'Underweight',
                        normal: 'Normal',
                        overweight: 'Overweight',
                        obese: 'Obese'
                    },
                    textInputPlaceholder: 'Enter text to summarize...',
                    valuePlaceholder: 'Enter value',
                    firstNumberPlaceholder: 'First number',
                    secondNumberPlaceholder: 'Second number',
                    passLengthPlaceholder: 'Password length (8-32)',
                    charInputPlaceholder: 'Enter text...',
                    urlInputPlaceholder: 'Enter URL...',
                    searchPlaceholder: 'Search tools...',
                    clearHistory: 'Clear History',
                    weight: 'Weight (kg)',
                    height: 'Height (cm)',
                    status: 'Status',
                    createdBy: 'Created by',
                    timestamp: 'Timestamp'
                }
            },
            vi: {
                translation: {
                    title: 'ToolHub - Hộp Công Cụ Đa Năng',
                    home: 'Trang chủ',
                    history: 'Lịch sử',
                    contact: 'Liên hệ',
                    summarize: 'Tóm tắt văn bản',
                    'length-converter': 'Chuyển đổi độ dài',
                    calculator: 'Máy tính',
                    'password-generator': 'Tạo mật khẩu',
                    'char-counter': 'Đếm ký tự',
                    'url-checker': 'Kiểm tra URL',
                    'temp-converter': 'Chuyển đổi nhiệt độ',
                    'currency-converter': 'Chuyển đổi tiền tệ',
                    'qr-generator': 'Tạo mã QR',
                    'image-compressor': 'Nén ảnh',
                    'bmi-calculator': 'Tính BMI',
                    'area-converter': 'Chuyển đổi diện tích',
                    welcome: 'Chào mừng đến với ToolHub',
                    description: 'Tóm tắt văn bản, chuyển đổi đơn vị, tạo mã QR và nhiều tính năng khác - miễn phí và dễ sử dụng.',
                    summarizeDesc: 'Tóm tắt nội dung dài thành một bản ngắn gọn bằng AI.',
                    lengthConverterDesc: 'Chuyển đổi độ dài giữa mét, kilômét, centimeters, inch, feet và yard.',
                    calculatorDesc: 'Thực hiện các phép tính cơ bản: cộng, trừ, nhân, chia.',
                    passwordGeneratorDesc: 'Tạo mật khẩu ngẫu nhiên an toàn với độ dài và loại ký tự tùy chỉnh.',
                    charCounterDesc: 'Đếm số ký tự và từ trong văn bản của bạn.',
                    urlCheckerDesc: 'Kiểm tra xem URL có hợp lệ và an toàn hay không.',
                    tempConverterDesc: 'Chuyển đổi giữa độ C, độ F và Kelvin.',
                    currencyConverterDesc: 'Chuyển đổi giữa các loại tiền tệ với tỷ giá thời gian thực.',
                    qrGeneratorDesc: 'Tạo mã QR cho URL hoặc văn bản.',
                    imageCompressorDesc: 'Nén ảnh để giảm kích thước tệp.',
                    bmiCalculatorDesc: 'Tính chỉ số khối cơ thể (BMI) của bạn.',
                    areaConverterDesc: 'Chuyển đổi giữa mét vuông, kilômét vuông, hecta, feet vuông và mẫu.',
                    short: 'Ngắn (~20%)',
                    medium: 'Trung bình (~30%)',
                    long: 'Dài (~40%)',
                    meter: 'Mét (m)',
                    kilometer: 'Kilômét (km)',
                    centimeter: 'Centimet (cm)',
                    inch: 'Inch (in)',
                    foot: 'Feet (ft)',
                    yard: 'Yard (yd)',
                    add: 'Cộng (+)',
                    subtract: 'Trừ (-)',
                    multiply: 'Nhân (*)',
                    divide: 'Chia (/)',
                    uppercase: 'Chữ hoa (A-Z)',
                    lowercase: 'Chữ thường (a-z)',
                    numbers: 'Số (0-9)',
                    symbols: 'Ký hiệu (!@#$%)',
                    celsius: 'Độ C (°C)',
                    fahrenheit: 'Độ F (°F)',
                    kelvin: 'Kelvin (K)',
                    m2: 'Mét vuông (m²)',
                    km2: 'Kilômét vuông (km²)',
                    ha: 'Hecta (ha)',
                    ft2: 'Feet vuông (ft²)',
                    mau: 'Mẫu (mẫu)',
                    creator: 'Tác giả',
                    dob: 'Ngày sinh',
                    email: 'Email',
                    phone: 'Số điện thoại',
                    close: 'Đóng',
                    usageStats: 'Thống kê sử dụng',
                    times: 'lần',
                    error: {
                        emptyText: 'Vui lòng nhập văn bản hợp lệ!',
                        invalidNumber: 'Vui lòng nhập số dương hợp lệ!',
                        invalidUrl: 'Vui lòng nhập URL hợp lệ!',
                        textTooLong: 'Văn bản quá dài (tối đa 10,000 ký tự)!',
                        invalidLength: 'Độ dài phải từ 8 đến 32!',
                        selectCharacterType: 'Vui lòng chọn ít nhất một loại ký tự!',
                        divideByZero: 'Không thể chia cho 0!',
                        noImage: 'Vui lòng chọn một hình ảnh!',
                        invalidImage: 'Định dạng hình ảnh không hợp lệ!',
                        apiFailed: 'Không thể lấy tỷ giá hối đoái.',
                        apiError: 'Lỗi kết nối API.',
                        unsafeUrl: 'Phát hiện URL không an toàn!',
                        qrFailed: 'Không thể tạo mã QR!',
                        compressFailed: 'Không thể nén hình ảnh!',
                        summarizeFailed: 'Không thể tóm tắt văn bản!'
                    },
                    summarizeText: 'Tóm tắt',
                    convertLength: 'Chuyển đổi',
                    calculate: 'Tính toán',
                    generatePassword: 'Tạo',
                    copyPassword: 'Sao chép',
                    countChars: 'Đếm',
                    checkURL: 'Kiểm tra',
                    convertTemp: 'Chuyển đổi',
                    convertCurrency: 'Chuyển đổi',
                    generateQR: 'Tạo mã QR',
                    compressImage: 'Nén',
                    calculateBMI: 'Tính BMI',
                    convertArea: 'Chuyển đổi',
                    searchTools: 'Tìm kiếm',
                    noHistory: 'Không có lịch sử.',
                    historyCleared: 'Đã xóa lịch sử!',
                    noToolsFound: 'Không tìm thấy công cụ!',
                    originalValue: 'Giá trị gốc',
                    originalUnit: 'Đơn vị gốc',
                    convertedValue: 'Giá trị chuyển đổi',
                    targetUnit: 'Đơn vị đích',
                    result: 'Kết quả',
                    characters: 'Ký tự',
                    words: 'Từ',
                    validUrl: 'URL hợp lệ',
                    compressedImage: 'Hình ảnh đã nén',
                    download: 'Tải xuống',
                    bmi: {
                        underweight: 'Thiếu cân',
                        normal: 'Bình thường',
                        overweight: 'Thừa cân',
                        obese: 'Béo phì'
                    },
                    textInputPlaceholder: 'Nhập văn bản để tóm tắt...',
                    valuePlaceholder: 'Nhập giá trị',
                    firstNumberPlaceholder: 'Số thứ nhất',
                    secondNumberPlaceholder: 'Số thứ hai',
                    passLengthPlaceholder: 'Độ dài mật khẩu (8-32)',
                    charInputPlaceholder: 'Nhập văn bản...',
                    urlInputPlaceholder: 'Nhập URL...',
                    searchPlaceholder: 'Tìm kiếm công cụ...',
                    clearHistory: 'Xóa lịch sử',
                    weight: 'Cân nặng (kg)',
                    height: 'Chiều cao (cm)',
                    status: 'Trạng thái',
                    createdBy: 'Tạo bởi',
                    timestamp: 'Thời gian'
                }
            },
            ja: {
                translation: {
                    title: 'ToolHub - 多機能ツールハブ',
                    home: 'ホーム',
                    history: '履歴',
                    contact: '連絡先',
                    summarize: 'テキスト要約',
                    'length-converter': '長さ変換',
                    calculator: '電卓',
                    'password-generator': 'パスワード生成',
                    'char-counter': '文字数カウント',
                    'url-checker': 'URLチェッカー',
                    'temp-converter': '温度変換',
                    'currency-converter': '通貨変換',
                    'qr-generator': 'QRコード生成',
                    'image-compressor': '画像圧縮',
                    'bmi-calculator': 'BMI計算',
                    'area-converter': '面積変換',
                    welcome: 'ToolHubへようこそ',
                    description: 'テキストの要約、単位変換、QRコード生成など、すべて無料で簡単に使用できます。',
                    summarizeDesc: '長いコンテンツをAIを使用して簡潔な要約にします。',
                    lengthConverterDesc: 'メートル、キロメートル、センチメートル、インチ、フィート、ヤード間で長さを変換します。',
                    calculatorDesc: '基本的な計算（加算、減算、乗算、除算）を実行します。',
                    passwordGeneratorDesc: 'カスタマイズ可能な長さと文字タイプで安全なランダムパスワードを生成します。',
                    charCounterDesc: 'テキストの文字数と単語数をカウントします。',
                    urlCheckerDesc: 'URLが有効かつ安全かどうかを確認します。',
                    tempConverterDesc: '摂氏、華氏、ケルビン間で変換します。',
                    currencyConverterDesc: 'リアルタイムの為替レートを使用して通貨を変換します。',
                    qrGeneratorDesc: 'URLまたはテキスト用のQRコードを生成します。',
                    imageCompressorDesc: '画像を圧縮してファイルサイズを縮小します。',
                    bmiCalculatorDesc: '体格指数（BMI）を計算します。',
                    areaConverterDesc: '平方メートル、平方キロメートル、ヘクタール、平方フィート、畝間で面積を変換します。',
                    short: '短い (~20%)',
                    medium: '中 (~30%)',
                    long: '長い (~40%)',
                    meter: 'メートル (m)',
                    kilometer: 'キロメートル (km)',
                    centimeter: 'センチメートル (cm)',
                    inch: 'インチ (in)',
                    foot: 'フィート (ft)',
                    yard: 'ヤード (yd)',
                    add: '加算 (+)',
                    subtract: '減算 (-)',
                    multiply: '乗算 (*)',
                    divide: '除算 (/)',
                    uppercase: '大文字 (A-Z)',
                    lowercase: '小文字 (a-z)',
                    numbers: '数字 (0-9)',
                    symbols: '記号 (!@#$%)',
                    celsius: '摂氏 (°C)',
                    fahrenheit: '華氏 (°F)',
                    kelvin: 'ケルビン (K)',
                    m2: '平方メートル (m²)',
                    km2: '平方キロメートル (km²)',
                    ha: 'ヘクタール (ha)',
                    ft2: '平方フィート (ft²)',
                    mau: '畝 (mẫu)',
                    creator: '作成者',
                    dob: '生年月日',
                    email: 'メール',
                    phone: '電話番号',
                    close: '閉じる',
                    usageStats: '使用統計',
                    times: '回',
                    error: {
                        emptyText: '有効なテキストを入力してください！',
                        invalidNumber: '有効な正の数を入力してください！',
                        invalidUrl: '有効なURLを入力してください！',
                        textTooLong: 'テキストが長すぎます（最大10,000文字）！',
                        invalidLength: '長さは8から32の間でなければなりません！',
                        selectCharacterType: '少なくとも1つの文字タイプを選択してください！',
                        divideByZero: 'ゼロで割ることはできません！',
                        noImage: '画像を選択してください！',
                        invalidImage: '無効な画像形式です！',
                        apiFailed: '為替レートの取得に失敗しました。',
                        apiError: 'API接続エラー。',
                        unsafeUrl: '安全でないURLが検出されました！',
                        qrFailed: 'QRコードの生成に失敗しました！',
                        compressFailed: '画像の圧縮に失敗しました！',
                        summarizeFailed: 'テキストの要約に失敗しました！'
                    },
                    summarizeText: '要約',
                    convertLength: '変換',
                    calculate: '計算',
                    generatePassword: '生成',
                    copyPassword: 'コピー',
                    countChars: 'カウント',
                    checkURL: 'チェック',
                    convertTemp: '変換',
                    convertCurrency: '変換',
                    generateQR: 'QRコード生成',
                    compressImage: '圧縮',
                    calculateBMI: 'BMI計算',
                    convertArea: '変換',
                    searchTools: '検索',
                    noHistory: '履歴がありません。',
                    historyCleared: '履歴がクリアされました！',
                    noToolsFound: 'ツールが見つかりません！',
                    originalValue: '元の値',
                    originalUnit: '元の単位',
                    convertedValue: '変換後の値',
                    targetUnit: '目標単位',
                    result: '結果',
                    characters: '文字数',
                    words: '単語数',
                    validUrl: '有効なURL',
                    compressedImage: '圧縮された画像',
                    download: 'ダウンロード',
                    bmi: {
                        underweight: '低体重',
                        normal: '正常',
                        overweight: '過体重',
                        obese: '肥満'
                    },
                    textInputPlaceholder: '要約するテキストを入力...',
                    valuePlaceholder: '値を入力',
                    firstNumberPlaceholder: '最初の数',
                    secondNumberPlaceholder: '2番目の数',
                    passLengthPlaceholder: 'パスワードの長さ (8-32)',
                    charInputPlaceholder: 'テキストを入力...',
                    urlInputPlaceholder: 'URLを入力...',
                    searchPlaceholder: 'ツールを検索...',
                    clearHistory: '履歴をクリア',
                    weight: '体重 (kg)',
                    height: '身長 (cm)',
                    status: '状態',
                    createdBy: '作成者',
                    timestamp: '時間'
                }
            }
        }
    }, () => {
        updateLanguage();
        languageSelector.value = i18next.language;
    });

    languageSelector.addEventListener('change', () => {
        const newLang = languageSelector.value;
        i18next.changeLanguage(newLang, () => {
            localStorage.setItem('language', newLang);
            updateLanguage();
            showHistory();
        });
    });

    function updateLanguage() {
        document.querySelectorAll('[data-i18n]').forEach(elem => {
            const key = elem.getAttribute('data-i18n');
            elem.textContent = i18next.t(key);
        });
        document.querySelectorAll('[data-i18n-placeholder]').forEach(elem => {
            const key = elem.getAttribute('data-i18n-placeholder');
            elem.placeholder = i18next.t(key);
        });
        document.title = i18next.t('title');
    }
}